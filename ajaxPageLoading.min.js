/* ajaxPageLoading - v1.2 Copyright 2016-2020 Cyberdean
 * https://github.com/Cyberdean/ajax-page-loading
 * Under GNU GENERAL PUBLIC LICENSE Version 3 */
const APL={loader:null,container:null,callback:null,failCallback:null,preloadMap:{},isSuccessCallback:function(e){return e.status<400},setFailCallback:function(e){this.failCallback=e},setCallback:function(e){this.callback=e},setLoader:function(e){this.loader=e},setContainer:function(e){this.container=e},loadAjax:function(e,t,n){e.startsWith("/")||(e="/"+e),null!=this.loader&&(this.loader.style.display="block");const a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState){try{const l=JSON.parse(a.responseText);APL.isSuccessCallback(a,l)?(null!=t&&null!=n&&history.pushState(e,t,n),APL.container.innerHTML=l.view,null!=APL.callback&&APL.callback(e,l.params),APL.addListener()):null!=APL.failCallback&&APL.failCallback(e,l)}catch{null!=APL.failCallback&&APL.failCallback(e,data)}null!=APL.loader&&(APL.loader.style.display="none")}},a.open("GET",e+(-1===e.indexOf("?")?"?":"&")+"j=1",!0),a.setRequestHeader("Accept","application/json"),a.send()},getUrl:function(e){let t,n=e.currentTarget.getAttribute("href");if(-1===n.indexOf("/")||n.startsWith("./")){let e=window.location.pathname;n.startsWith("./")&&(n=n.substr(2)),e.endsWith("/")||(e+="/"),t=e+n}else t=e.currentTarget.getAttribute("href");return t},clickHandler:function(e){const t=APL.getUrl(e);return APL.loadAjax(t,e.currentTarget.textContent,e.currentTarget.href),window.onpopstate=function(e){null==e.state?APL.loadAjax("/"):APL.loadAjax(e.state)},e.preventDefault()},onMouseOverHandler:function(e){const t=APL.getUrl(e);!1!==APL.preloadMap[t]&&(APL.preloadMap[t]=setTimeout((function(){APL.preloadMap[t]=!1;const e=new XMLHttpRequest;e.open("GET",t+(-1===t.indexOf("?")?"?":"&")+"j=1",!0),e.setRequestHeader("Accept","application/json"),e.send()}),300))},onMouseOutHandler:function(e){const t=APL.getUrl(e);!1!==APL.preloadMap[t]&&(clearTimeout(APL.preloadMap[t]),delete APL.preloadMap[t])},addListener:function(){const e=document.getElementsByTagName("a");for(let t=0,n=e.length;t<n;t++){if(e[t].hasAttribute("target")&&"_parent"!==e[t].getAttribute("target")&&"_self"!==e[t].getAttribute("target"))continue;const n=e[t].hasAttribute("href");if(!n||n&&0===e[t].getAttribute("href").indexOf("#"))continue;const a=e[t].getAttribute("href").split("/");a.length>0&&0===a.pop().indexOf("#")||(e[t].removeEventListener("click",this.clickHandler),e[t].addEventListener("click",this.clickHandler),e[t].removeEventListener("mouseover",this.onMouseOverHandler),e[t].addEventListener("mouseover",this.onMouseOverHandler),e[t].removeEventListener("mouseout",this.onMouseOutHandler),e[t].addEventListener("mouseout",this.onMouseOutHandler),e[t].removeEventListener("touchstart",this.onMouseOverHandler),e[t].addEventListener("touchstart",this.onMouseOverHandler),e[t].removeEventListener("touchcancel",this.onMouseOutHandler),e[t].addEventListener("touchcancel",this.onMouseOutHandler),e[t].removeEventListener("touchend",this.onMouseOutHandler),e[t].addEventListener("touchend",this.onMouseOutHandler))}}};APL.addListener();
